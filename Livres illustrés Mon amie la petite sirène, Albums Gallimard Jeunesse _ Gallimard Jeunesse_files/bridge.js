var ALVEOS_BRIDGE=function(){var a,b,c,d,e,f=[],g={"www.cantook.net":"cant","coopsco.cantook.net":"csco","www.edenlivres.fr":"eden","edigita.cantook.net":"edgt","www.entrepotnumerique.com":"enqc","www.depotgie.com":"fdis","trancontinental.cantook.net":"trco","enqc.develop.demarque.com":"enqc","edgt.develop.demarque.com":"edgt","enqc.staging.demarque.com":"enqc","edgt.staging.demarque.com":"edgt","trco.staging.demarque.com":"trco"},h={cant:"assets.cantook.net",csco:"assets-csco.cantook.net",eden:"assets.edenlivres.fr",edgt:"assets-edgt.cantook.net",enqc:"assets.entrepotnumerique.com",fdis:"assets.depotgie.com",trco:"assets-trco.cantook.net"},i=ALVEOS_BRIDGE.Helpers,j=[];this.initialize=function(){var c,a=d();return!!a&&(c=i.parse_uri(a.src),!!e(c.authority,c.queryKey)&&(i.insert_stylesheet(f.protocol+"//"+f.domain+"/m/default/shared/main.css"),b(""),!0))},this.build=function(a,b){if(null!==a){var d=a.publication,e=a.organisation,f=c(d.called_with_id);f&&(f.state_request="found",f.parse_data(d,e),f.generate(),f.clean_request())}},this.build_not_found=function(a){var b=c(a);b&&(b.request_state="not_found",b.generate(),b.clean_request())},this.pop=function(a,b,c){return i.pop(a,b,c)},this.update=function(a){a||(a=""),b(a)},a=function(a){var b=new ALVEOS_BRIDGE.Publication(f);null===c(a)&&(b.set_id(a),b.config_site=f,b.load(f.domain),j[j.length]=b)},b=function(b){var c,e,h,d=f.sys_id+"-wrap-",g=document;if(""!==b&&(g=document.getElementById(b)),null!==g){c=g.getElementsByTagName("div");for(var i=0;i<c.length;i++)if("undefined"!=typeof c[i].id&&c[i].id.indexOf(d)!==-1)a(c[i].id.replace(d,""));else if("undefined"!=typeof c[i].className){h=c[i].className.split(" "),e=-1;for(var j=0;j<h.length;j++)h[j].indexOf(d)!==-1&&(e=j);e>-1&&a(h[e].replace(d,""))}}},c=function(a){var b;for(b=0;b<j.length;b++)if(j[b].get_id()===a)return j[b];return null},d=function(){var a,b=document.getElementsByTagName("script");for(a in b)if(void 0!==b[a].src&&b[a].src.indexOf("/api/bridge.js")!==-1)return b[a];return null},e=function(a,b){var c=!0;return""!==a?(f.domain=a,f.sys_id=g[a]):(f.domain="",c=!1),f.protocol=/file/.test(location.protocol)?"http:":location.protocol,"undefined"!=typeof b.asset_domain&&(f.asset_domain=b.asset_domain),void 0!==b.mid?f.mid=b.mid:void 0!==b.organisation_id?f.mid=b.organisation_id:(f.mid="0",c=!1),void 0===b.l?f.language="fr":"en"===b.l?f.language="en":f.language="fr",c}};ALVEOS_BRIDGE.Publication=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,w,t=ALVEOS_BRIDGE.Helpers,u="",v=this;this.config_site=[],this.formats={},this.request_state="processing",this.clean_request=function(){t.clean_request(u)},this.generate=function(){i(),j(),g(),d(),f("text"),f("cover"),f("mini"),f("full"),e(),o()},this.get_id=function(){return u},this.is_not_found=function(){return"not_found"===v.request_state},this.load=function(){var b=v.config_site.domain+"/api/organisations/"+a.mid+"/publications/"+u+".js",c={v:2};w=s(u),t.send_json_request(b,c,u)},this.parse_data=function(a,b){q(a,b),p(a,b)},this.set_id=function(a){u=a},b=function(a,b){c(w,function(c){var d=t.first_with_class(v.config_site.sys_id+"-"+a,c,"span");d&&(d.innerHTML=b)})},c=function(a,b){var c,d;c=document.getElementById(a),c&&b.apply(this,[c]),d="function"==typeof document.getElementsByClassName?document.getElementsByClassName(a):t.getElementsByClassName(a);for(var e=0;e<d.length;e++)b.apply(this,[d[e]])},d=function(){var a=v.authors&&v.authors.length>0;r("authors",a),a&&b("authors-name",v.authors)},e=function(){c(w,function(a){var b=t.first_with_class(v.config_site.sys_id+"-pdf-excerpt",a,"div");b&&(v.formats&&v.formats.pdf&&v.formats.pdf.provide_excerpt&&v.url_excerpt?b.innerHTML='<a href="'+v.url_excerpt+'" onclick="return alveos_bridge.pop(\''+v.url_excerpt+'\');" target="_blank">'+b.innerHTML+"</a>":t.hide(b))})},f=function(b){var d="ffffff",e=0,f=0;c(w,function(c){var g=t.first_with_class("flipbook-"+b,c,"div");if(g)if(v.formats&&(v.formats.pdf||v.formats.epub)&&v.show_flipbook)switch(b){case"text":g.innerHTML='<a href="'+v.url_flipbook+'" onclick="return alveos_bridge.pop(\''+v.url_flipbook+'\');" target="_blank">'+g.innerHTML+"</a>";break;case"cover":g.innerHTML='<a href="'+v.url_flipbook+'" onclick="return alveos_bridge.pop(\''+v.url_flipbook+'\');" target="_blank"><img src="'+v.url_cover+'" style="border:none;" alt="'+v.title+'" /></a>';break;case"mini":e=n(g,100,350),f=m(e),d=l(g),g.innerHTML='<iframe src="'+v.url_flipbook+"&l="+a.language+"&m=2&c="+d+'" style="border:none;height:'+f+"px;margin:0px;padding:0px;width:"+e+'px;" webkitallowfullscreen=true mozallowfullscreen=true oallowfullscreen=true msallowfullscreen=true khtmlallowfullscreen=true></iframe>';break;case"full":e=n(g,550,950),f=m(e),d=l(g),g.innerHTML='<iframe src="'+v.url_flipbook+"&l="+a.language+"&m=1&c="+d+'" style="border:none;height:'+f+"px;margin:0px;padding:0px;width:"+e+'px;" webkitallowfullscreen=true mozallowfullscreen=true oallowfullscreen=true msallowfullscreen=true khtmlallowfullscreen=true></iframe>'}else t.hide(g)})},g=function(){h("pdf"),h("epub")},h=function(a){v.formats&&v.formats[a]&&"sell"===v.formats[a].state?(/acs4/.test(v.formats[a].protection)&&r(a+"-no-acs4",!1),k(a+"-cost",v.formats[a].cost)):c(w,function(b){var c=t.first_with_class(s(a),b,"div");t.hide(c)})},i=function(){c(w,function(a){var b=t.first_with_class(s("not-found"),a,"div");b&&!v.is_not_found()&&t.hide(b)})},j=function(){k("title",v.title),k("summary",v.summary),k("tags",v.tags),k("language",v.language),k("translated-from",v.translated_from)},k=function(a,c){var d=!t.is_empty(c);r(a,d),d&&b(a,c)},l=function(a){var b=a.style.backgroundColor;return b.indexOf("rgb")!==-1?t.rgb_to_hex(b).replace("#",""):"ffffff"},m=function(a){var b=0;return b=a/2*v.page_height/v.page_width,b=Math.floor(b)+1,v.page_width>500&&(v.page_height+=40),b},n=function(a,b,c){var d=a.style.width.replace("px","");return d<b?d=b:d>c&&(d=c),d},o=function(){c(w,function(a){a.className+=" data-parsed"})},p=function(a,b){format_data=a.formats.format;var d,c={};if(v.formats={},format_data)for("undefined"==typeof format_data.length&&(format_data=[format_data]),d=0;d<format_data.length;d++){c={},c.nature=format_data[d].nature,c.value=format_data[d].value,c.issued_on=format_data[d].issued_on,c.protection=format_data[d].protection,c.provide_excerpt=format_data[d].provide_excerpt,b.sell_online&&b.access_to_publication?(c.state=format_data[d].state,c.cost=format_data[d].costs[b.country]):c.state="view",v.formats[c.nature]=c;var e=v.config_site.protocol+"//";e+=document.domain?document.domain:v.config_site.domain,format_data[d].value===u?void 0!==format_data[d].url_flipbook?v.url_flipbook=format_data[d].url_flipbook:v.url_flipbook=a.url_flipbook:void 0===v.url_flipbook&&(v.url_flipbook=a.url_flipbook),void 0!==v.url_flipbook&&(v.url_flipbook=decodeURI(v.url_flipbook).replace("{{ORG_ID_COMPLEX}}",b.id_complex).replace("{{ORG_IDENTIFIER}}",b.identifier)+(v.url_flipbook.indexOf("?")===-1?"?":"&")+"l="+v.config_site.language+"&r="+e)}},q=function(a,b){v.record_id=a.id,v.title=a.title,v.summary=a.summary,v.tags=a.tags?a.tags.replace(/;/gi,", "):"",v.language=a.language,v.translated_from=a.translated_from,v.page_width=a.page_width,v.page_height=a.page_height,v.authors=a.authors,v.sellable=a.sellable,v.url_cover=a.url_cover,a.url_excerpt&&(v.url_excerpt=decodeURI(a.url_excerpt).replace("{{ORG_ID_COMPLEX}}",b.id_complex).replace("{{ORG_IDENTIFIER}}",b.identifier)),v.show_flipbook=a.show_flipbook},r=function(a,b){c(w,function(c){var d=t.first_with_class(s(a),c,"div");if(d&&(v.is_not_found()||!b))return void t.hide(d)})},s=function(a){return v.config_site.sys_id+"-wrap-"+a}},ALVEOS_BRIDGE.Helpers=function(){var a,b={};return b.getElementsByClassName=function(a,b,c){var d=new Array;null==b&&(b=document),null==c&&(c="*");var e=b.getElementsByTagName(c),f=e.length,g=new RegExp("(^|\\s)"+a+"(\\s|$)");for(i=0,j=0;i<f;i++)g.test(e[i].className)&&(d[j]=e[i],j++);return d},b.all_with_class=function(a,b,c){b=b||document;var g,d=[],e=!c&&b.all||b.getElementsByTagName(c||"*"),f=new RegExp("(^|\\s)"+a+"(\\s|$)");for(g=0;g<e.length;g++)f.test(e[g].className)&&(d[d.length]=e[g]);return d},b.clean_request=function(a){document.getElementsByTagName("head").item(0).removeChild(document.getElementById("json_request_"+a))},b.rgb_to_hex=function(a){var c,b=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(delete b[0],c=1;c<=3;++c)b[c]=parseInt(b[c],10).toString(16),1===b[c].length&&(b[c]="0"+b[c]);return b.join("")},b.first_with_class=function(a,b,c){return this.all_with_class(a,b,c)[0]},b.format_cost=function(a,b){var c=String(a/100).replace(".",",");switch(c.lastIndexOf(",")===-1?c+=",00":c.length-c.lastIndexOf(",")===2&&(c+="0"),b){case"eur":c+="â‚¬";break;case"cad":c+="$"}return c},b.has_class=function(a,b){return a.className.indexOf(b)!==-1},b.hide=function(b){a(b,"none")},b.insert_stylesheet=function(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a,document.getElementsByTagName("head")[0].appendChild(b)},b.is_empty=function(a){return"undefined"==typeof a||""===a},b.list_commas=function(a){var c,b="";for(c=0;c<a.length;c++)""!==b&&(b+=", "),b+=a[c];return b},b.parse_uri=function(a){for(var b=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c=/(?:^|&)([^&=]*)=?([^&]*)/g,d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],e=b.exec(a),f={},g=14;g--;)f[d[g]]=e[g]||"";return f.queryKey={},f[d[12]].replace(c,function(a,b,c){b&&(f.queryKey[b]=c)}),f},b.pop=function(a,b,c){var d="undefined"==typeof b?window.top.screen.width-80:b,e="undefined"==typeof c?window.top.screen.height-145:c,f="top=40,left=40,width="+d+",height="+e+",menubar=no,scrollbars=yes,toolbar=no,location=no,directories=no,resizable=yes,status=yes",g=window.open(a,"_blank",f);return null===g||(g.focus&&g.focus(),!1)},b.send_json_request=function(a,b,c){var f,g,h,d=document.getElementsByTagName("head").item(0),e="json_request_"+c,i=[];for(g in b)b.hasOwnProperty(g)&&(i[i.length]=g+"="+b[g]);i.length>0&&(a+="?"+i.join("&")),h=/file/.test(location.protocol)?"http:":location.protocol,f=document.createElement("script"),f.setAttribute("type","text/javascript"),f.setAttribute("src",h+"//"+a),f.setAttribute("id",e),d.appendChild(f)},b.show=function(b){a(b,"block")},b.t=function(a,b){switch(b){case"fr":switch(a){case"glissoire.close":return"Fermer";case"glissoire":return"Glissoire"}break;case"en":switch(a){case"glissoire.close":return"Close";case"glissoire":return"Glissoire"}}return""},a=function(a,b){a&&(a.style||(a=document.getElementById(a)),a&&a.style&&(a.style.display=b))},b},ALVEOS_BRIDGE.Helpers=ALVEOS_BRIDGE.Helpers(),ALVEOS_BRIDGE.ready=function(){var b,c,d,e,f,a=[],g=document,h=window,i="readyState",j="onreadystatechange",k=function(){for(clearInterval(b);e=a.shift();)e();c&&(c[j]="")};return function(c){return d?c():(a[0]||(g.addEventListener&&g.addEventListener("DOMContentLoaded",k,!1),/WebKit/i.test(navigator.userAgent)&&(b=setInterval(function(){/loaded|complete/.test(g[i])&&k()},10)),f=h.onload,h.onload=function(){k(),f&&f()}),a.push(c),!0)}}();var alveos_bridge=new ALVEOS_BRIDGE;ALVEOS_BRIDGE.ready(function(){alveos_bridge.initialize()});
